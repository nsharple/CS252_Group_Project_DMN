<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Google Signin meta tags -->
	<meta name="google-signin-scope" content="profile email">
	<meta name="google-signin-client_id" content="16789477210-7hhak27tf126sdm84618trt2f5qlptip.apps.googleusercontent.com">

    <script>
	function includeHTML() {
		var elements, i, element, file, xhttp;
		// Loop through each HTML element in the file to be included
		elements = document.getElementsByTagName("*");
		for (i = 0; i < elements.length; i++) {
			element = elements[i];
			file = element.getAttribute("include-html");
			if (file) {
				// Make an HTTP request using the attribute as the file name
				xhttp = new XMLHttpRequest();
				xhttp.onreadystatechange = function() {
					if (this.readyState == 4) {
						if (this.status == 200) {element.innerHTML = this.responseText;}
						if (this.status == 400) {element.innerHTML = "Page not found.";}
						// Remove the attribute and call this function again
						element.removeAttribute("include-html");
						includeHTML();
					}
				}
				xhttp.open("GET", file, false);
				xhttp.send();
				// Exit the function
				return;
			}
		}
	}

	function addGoogleScript()
	{
	    var script = document.createElement("script");
	    script.src = "https://apis.google.com/js/platform.js";
	    script.async = true;
	    script.defer = true;
	    document.head.appendChild(script);
	}

	function onSignIn(googleUser) {

		// Useful data for client-side scripts:
		var profile = googleUser.getBasicProfile();

		// Set the email value for the form
		document.getElementById("coachEmail").setAttribute("value", profile.getEmail());

		// Show user email and profile picture in nav
		document.getElementById("userEmailNav").removeAttribute("hidden");
        document.getElementById("userEmailNav").innerHTML = profile.getEmail();
        document.getElementById("userPicNav").removeAttribute("hidden");
		document.getElementById("userPicNav").setAttribute("src", profile.getImageUrl());

		// Show sign out button now
		document.getElementById("signOutButton").removeAttribute("hidden");
		document.getElementById("signInButton").setAttribute("hidden", true);
	}

	function getEarliestDate() {
		var dateToday = new Date();
		var year = dateToday.getFullYear();
		var month = dateToday.getMonth() + 1;
		var day = dateToday.getDate();
		var formattedDate = year + "-" + month + "-" + day;j
		console.log(formattedDate);
		document.getElementById("inputEndDate").setAttribute("min", formattedDate);
	}

	function onTypeChange() {
		var choice = document.getElementById("inputType").value;
		document.getElementById("goalLabel").innerHTML = choice;
		if (choice == "Distance") {
			document.getElementById("inputGoal").setAttribute("name", "distance");
			document.getElementById("inputGoal").setAttribute("placeholder", "26.2");
			document.getElementById("inputGoal").setAttribute("pattern", "[0-9]{0,8}.?[0-9]{0,2}");
			document.getElementById("inputGoal").setAttribute("title", "Number in format: 'XXXXXXXX.XX'");

			document.getElementById("typeLabel").innerHTML = "Miles";
		}
		else if (choice == "Time") {
			document.getElementById("inputGoal").setAttribute("name", "time");
			document.getElementById("inputGoal").setAttribute("placeholder", "4");
			document.getElementById("inputGoal").setAttribute("pattern", "[0-9]{0,8}.?[0-9]{0,2}");
			document.getElementById("inputGoal").setAttribute("title", "Time in format: 'XXXXXXXX.XX'");

			document.getElementById("typeLabel").innerHTML = "Hours";
		}
		else if (choice == "Number of Runs") {
			document.getElementById("inputGoal").setAttribute("name", "numRuns");
			document.getElementById("inputGoal").setAttribute("placeholder", "5");
			document.getElementById("inputGoal").setAttribute("pattern", "[0-9]{1,10}");
			document.getElementById("inputGoal").setAttribute("title", "Number of runs at most 10 digits long");

			document.getElementById("typeLabel").innerHTML = "Runs";
		}
	}

	function signOut() {

		// Hide sign out button. Show sign in button.
		document.getElementById("signOutButton").setAttribute("hidden", true);
		document.getElementById("signInButton").removeAttribute("hidden");

		// Hide user email and picture
		document.getElementById("userEmailNav").setAttribute("hidden", true);
		document.getElementById("userPicNav").setAttribute("hidden", true);

		var auth2 = gapi.auth2.getAuthInstance();
		auth2.signOut().then(function () {
			console.log('User signed out.');
		});
	}

	function updateCoachEmail() {
		if (!document.getElementById("inputEmails").value) {
			document.getElementById("inputEmails").setAttribute("value", document.getElementById("coachEmail").value);
			document.getElementById("coachEmail").setAttribute("value", "");
		}
	}

</script>

	<!-- Bootstrap stuff -->
    <link rel="stylesheet" href="css/bootstrap.min.css"/>
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="css/styles.css">

    <title>RunRecordShare</title>
</head>


<body>

	<!-- Navbar -->
	<div include-html="navbar_include.html"></div>

	<!-- New Log Form -->
	<form onSubmit="updateCoachEmail()" action="https://us-east1-runrecordshare.cloudfunctions.net/new-goal">
		<div class="form-group">
			<input type="hidden" class="form-control" id="coachEmail" name="coachEmail">
		</div>
		<div class="form-group">
			<label for="inputEmails">Email(s)</label>
			<input type="email" class="form-control" id="inputEmails" multiple name="email" aria-describedby="emailsHelpText">
			<small id="emailsHelpText" class="form-text text-muted">Leave this blank if this is a personal goal. Enter a comma separated list of emails if this goal is for other runners.</small>
		</div>
		<div class="form-group">
			<label for="inputType">Goal Type</label>
			<select class="form-control" id="inputType" name="type" selected="Distance" onchange="onTypeChange()" required>
				<option value="Distance">Distance</option>
				<option value="Time">Time</option>
				<option value="Number of Runs">Number of Runs</option>
			</select>
		</div>
		<div class="form-group">
			<label for="inputGoal" id="goalLabel">Distance</label>
			<input type="text" class="form-control" id="inputGoal" placeholder="26.2" name="distance" required>
			<label for="miles" id="typeLabel">Miles</label>
		</div>
		<div class="form-group">
			<label for="inputStartDate">Start Date</label>
			<input type="date" class="form-control" id="inputStartDate" name="start_date" required>
		</div>
		<div class="form-group">
			<label for="inputEndDate">End Date</label>
			<input type="date" class="form-control" id="inputEndDate" name="end_date" title="Put an end that is no earlier than today" onclick="getEarliestDate()" required>
		</div>
		<div class="form-group">
			<label for="inputNotes">Notes</label>
			<input type="text" class="form-control" id="inputNotes" name="notes" placeholder="Place any notes about your goal here!" maxlength="1000" title="1000 max characters" aria-describedby="notesHelpBlock">
			<small id="notesHelpBlock" class="form-text text-muted">Your notes may not exceed 1000 characters.</small>
		</div>
		<button type="submit" class="btn btn-primary">Create Goal</button>
	</form>

	<script>
	includeHTML();
	addGoogleScript();
	</script>

</body>

</html>
